# MEMORY.md - 长期记忆

## 🎬 短剧平台项目 (OpenDrama - 开源短剧)

### 项目概述
- **项目名称**: OpenDrama (开源短剧) - AI短剧创作平台
- **技术栈**: 
  - 后端: Go + Gin + SQLite/PostgreSQL
  - 前端: Vue 3 + TypeScript + Element Plus + Vite
  - 部署: Docker + 腾讯云

### 项目状态
- ✅ **基础架构已搭建完成**
- ✅ **服务器运行正常**
  - 后端API: http://43.160.239.253:5678
  - 前端界面: http://43.160.239.253:3012
- ✅ **数据库和存储已配置**
- ✅ **开发环境已配置**

### 核心功能模块
1. **剧本管理**
   - 创建/编辑短剧剧本
   - 剧本大纲管理
   - 角色设定
   - 分集管理

2. **角色管理**
   - 角色库管理
   - 角色形象生成(AI)
   - 角色特征设定

3. **道具管理**
   - 道具库
   - 道具图片生成
   - 道具关联管理

4. **AI集成**
   - 多AI服务配置支持
   - 剧本生成
   - 角色和道具图片生成
   - 视频生成

5. **故事板生成**
   - 分镜头脚本生成
   - 视觉化预览

6. **音频处理** 
   - ✅ 音频提取 (从视频提取现有音频)
   - ❌ TTS语音合成 (缺失)

### 已解决的技术问题
- **2026-02-12**: 网络访问问题 - 通过配置Vite的host和CORS解决
- **端口冲突**: Go服务(5678)和前端服务(3012)分离
- **云服务器配置**: 腾讯云安全组端口开放

### 项目状态 (2026-02-18)

- ✅ **基础架构已搭建完成**
- ✅ **服务器运行正常**
- ✅ **NewAPI架构** - 已完成 (阶段一)
- ✅ **TTS语音合成** - 已完成 (阶段二)
- 🔄 **前端优化** - 进行中 (阶段三)
- 📝 **GitHub提交**: 18次
- 🎯 **总体进度**: 90%

### 🔍 发现的技术缺陷 (2026-02-12)

- **TTS语音合成功能缺失**: 
  - 当前只有音频提取功能 (`/api/audio/extract`)
  - 缺少文本转语音(TTS)模型配置
  - 无法实现AI配音，只能外部导入或手动录制
  - 需要集成Azure TTS、阿里云TTS等服务

- **AI服务架构需要升级到NewAPI**:
  - **现状**: 分散对接各AI服务商，代码复杂度高
  - **问题**: 硬编码provider逻辑，扩展性差，配置复杂
  - **NewAPI优势**: 统一接口、负载均衡、成本优化、高可用性
  - **升级方向**: 移除分散逻辑，统一通过NewAPI路由所有AI请求

### 项目文件结构
```
huobao-drama/
├── main.go                 # Go后端入口
├── api/                    # API路由和处理器
├── application/            # 应用层逻辑
├── domain/                 # 业务领域模型
├── infrastructure/         # 基础设施
├── web/                    # Vue.js前端
│   ├── src/               # 前端源码
│   ├── package.json       # 前端依赖
│   └── vite.config.ts     # Vite配置
└── docker-compose.yml     # Docker部署配置
```

### 下一步开发计划

#### 🎯 核心功能完善
1. **TTS语音合成系统** (高优先级)
   - 添加TTS模型配置 (Azure/阿里云/腾讯云/OpenAI)
   - 实现文本转语音API (`/api/tts/generate`)
   - 语音角色选择和音色配置
   - 批量配音生成功能
   - 前端配音管理界面

2. **完善前端界面**
   - 剧本创建和编辑页面
   - 角色管理界面
   - 道具管理功能
   - 配音工作室界面

3. **AI服务集成**
   - 接入更多AI服务(OpenAI, Claude等)
   - 优化生成效果
   - TTS服务集成

#### 🚀 高级功能
4. **用户体验优化**
   - 拖拽排序
   - 批量操作
   - 导入导出功能
   - 实时预览功能

5. **性能优化**
   - 数据库查询优化
   - 前端代码分割
   - 图片压缩和CDN

#### 🔧 系统完善
6. **用户管理系统**
   - 用户注册登录
   - 权限控制
   - 项目分享功能

7. **工作流优化**
   - 一键生成完整短剧
   - 模板系统
   - 自动化流程

### 重要配置
- **服务器**: 腾讯云 VM-0-7-opencloudos
- **公网IP**: 43.160.239.253
- **后端端口**: 5678
- **前端端口**: 3012
- **开发环境**: /root/.openclaw/workspace/huobao-drama/

### 技术要点
- Go使用Gin框架，支持CORS
- Vue 3 + Composition API
- TypeScript开发
- Element Plus UI组件库
- Vite构建工具
- Docker容器化部署

---

*最后更新: 2026-02-12*